{"version":3,"file":"module.min.js","sources":["../src/module.js"],"sourcesContent":["// This file is part of Moodle - http://moodle.org/\n//\n// Moodle is free software: you can redistribute it and/or modify\n// it under the terms of the GNU General Public License as published by\n// the Free Software Foundation, either version 3 of the License, or\n// (at your option) any later version.\n//\n// Moodle is distributed in the hope that it will be useful,\n// but WITHOUT ANY WARRANTY; without even the implied warranty of\n// MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the\n// GNU General Public License for more details.\n//\n// You should have received a copy of the GNU General Public License\n// along with Moodle.  If not, see <http://www.gnu.org/licenses/>.\n\nimport Ajax from 'core/ajax';\nimport Notification from 'core/notification';\n\n/**\n * @type const\n */\nconst SELECTORS = {\n    input: '#id_coupon',\n    action: '#btncheckcoupon'\n};\n\n/**\n * Call server to validate given coupon code.\n *\n * @param {string} couponCode coupon code\n * @param {Number} courseId course ID\n * @param {Number} instanceId enrol instance ID\n * @returns {Promise<>}\n */\nconst checkCode = (couponCode, courseId, instanceId) => {\n    const request = {\n        methodname: 'enrol_gwpayments_check_coupon',\n        args: {\n            couponcode: couponCode,\n            courseid: courseId,\n            instanceid: instanceId\n        }\n    };\n\n    return Ajax.call([request])[0];\n};\n\n/**\n * Perform coupon code check.\n *\n * @param {Event} e\n * @returns {Promise}\n */\nconst performCheck = (e) => {\n    e.preventDefault();\n    let el = document.querySelector(SELECTORS.input);\n    if (typeof el === 'undefined' || el === null) {\n        return;\n    }\n    let code = el.value;\n    if (code.length === 0) {\n        return;\n    }\n    checkCode(code, el.dataset.courseid, el.dataset.instanceid)\n        .then((response) => {\n            if (response.result) {\n                if (response.data.freepass) {\n                    window.location.href = response.data.freepassredirect;\n                } else {\n                    document.querySelector('#enrol-gwpayments-coupondiscount').innerHTML = response.data.html;\n                    document.querySelector('#enrol-gwpayments-coupondiscount').classList.remove('warning');\n                    document.querySelector('#enrol-gwpayments-coupondiscount').classList.add('success');\n                    document.querySelector('#enrol-gwpayments-basecost').classList.add('enrol-gwpayments-strike');\n                }\n            } else {\n                document.querySelector('#enrol-gwpayments-coupondiscount').innerHTML = response.error;\n                document.querySelector('#enrol-gwpayments-coupondiscount').classList.add('warning');\n                document.querySelector('#enrol-gwpayments-coupondiscount').classList.remove('success');\n                document.querySelector('#enrol-gwpayments-basecost').classList.remove('enrol-gwpayments-strike');\n            }\n        })\n        .fail(Notification.exception);\n};\n\n/**\n * Exported initializer\n *\n * @returns {void}\n */\nexport const init = () => {\n    document.querySelector(SELECTORS.input).addEventListener('blur', performCheck);\n    document.querySelector(SELECTORS.action).addEventListener('click', performCheck);\n};\n"],"names":["SELECTORS","performCheck","e","preventDefault","el","document","querySelector","code","value","length","couponCode","courseId","instanceId","request","methodname","args","couponcode","courseid","instanceid","Ajax","call","checkCode","dataset","then","response","result","data","freepass","window","location","href","freepassredirect","innerHTML","html","classList","remove","add","error","fail","Notification","exception","addEventListener"],"mappings":"kXAqBMA,gBACK,aADLA,iBAEM,kBA8BNC,aAAgBC,IAClBA,EAAEC,qBACEC,GAAKC,SAASC,cAAcN,oBAC5B,MAAOI,cAGPG,KAAOH,GAAGI,MACM,IAAhBD,KAAKE,QA1BK,EAACC,WAAYC,SAAUC,oBAC/BC,QAAU,CACZC,WAAY,gCACZC,KAAM,CACFC,WAAYN,WACZO,SAAUN,SACVO,WAAYN,oBAIbO,cAAKC,KAAK,CAACP,UAAU,IAmB5BQ,CAAUd,KAAMH,GAAGkB,QAAQL,SAAUb,GAAGkB,QAAQJ,YAC3CK,MAAMC,WACCA,SAASC,OACLD,SAASE,KAAKC,SACdC,OAAOC,SAASC,KAAON,SAASE,KAAKK,kBAErC1B,SAASC,cAAc,oCAAoC0B,UAAYR,SAASE,KAAKO,KACrF5B,SAASC,cAAc,oCAAoC4B,UAAUC,OAAO,WAC5E9B,SAASC,cAAc,oCAAoC4B,UAAUE,IAAI,WACzE/B,SAASC,cAAc,8BAA8B4B,UAAUE,IAAI,6BAGvE/B,SAASC,cAAc,oCAAoC0B,UAAYR,SAASa,MAChFhC,SAASC,cAAc,oCAAoC4B,UAAUE,IAAI,WACzE/B,SAASC,cAAc,oCAAoC4B,UAAUC,OAAO,WAC5E9B,SAASC,cAAc,8BAA8B4B,UAAUC,OAAO,+BAG7EG,KAAKC,sBAAaC,0BAQP,KAChBnC,SAASC,cAAcN,iBAAiByC,iBAAiB,OAAQxC,cACjEI,SAASC,cAAcN,kBAAkByC,iBAAiB,QAASxC"}