{"version":3,"sources":["../src/module.js"],"names":["SELECTORS","input","action","checkCode","couponCode","courseId","instanceId","Ajax","call","methodname","args","couponcode","courseid","instanceid","performCheck","e","preventDefault","el","document","querySelector","code","value","length","dataset","then","response","result","data","freepass","window","location","href","freepassredirect","innerHTML","html","classList","remove","add","error","fail","Notification","exception","init","addEventListener"],"mappings":"6cAeA,OACA,O,yiBAKMA,CAAAA,CAAS,CAAG,CACdC,KAAK,CAAE,YADO,CAEdC,MAAM,CAAE,iBAFM,C,CAaZC,CAAS,CAAG,SAACC,CAAD,CAAaC,CAAb,CAAuBC,CAAvB,CAAsC,CAUpD,MAAOC,CAAAA,CAAI,CAACC,IAAL,CAAU,CATD,CACZC,UAAU,CAAE,+BADA,CAEZC,IAAI,CAAE,CACFC,UAAU,CAAEP,CADV,CAEFQ,QAAQ,CAAEP,CAFR,CAGFQ,UAAU,CAAEP,CAHV,CAFM,CASC,CAAV,EAAqB,CAArB,CACV,C,CAQKQ,CAAY,CAAG,SAACC,CAAD,CAAO,CACxBA,CAAC,CAACC,cAAF,GACA,GAAIC,CAAAA,CAAE,CAAGC,QAAQ,CAACC,aAAT,CAAuBnB,CAAS,CAACC,KAAjC,CAAT,CACA,GAAkB,WAAd,QAAOgB,CAAAA,CAAP,EAAoC,IAAP,GAAAA,CAAjC,CAA8C,CAC1C,MACH,CACD,GAAIG,CAAAA,CAAI,CAAGH,CAAE,CAACI,KAAd,CACA,GAAoB,CAAhB,GAAAD,CAAI,CAACE,MAAT,CAAuB,CACnB,MACH,CACDnB,CAAS,CAACiB,CAAD,CAAOH,CAAE,CAACM,OAAH,CAAWX,QAAlB,CAA4BK,CAAE,CAACM,OAAH,CAAWV,UAAvC,CAAT,CACKW,IADL,CACU,SAACC,CAAD,CAAc,CAChB,GAAIA,CAAQ,CAACC,MAAb,CAAqB,CACjB,GAAID,CAAQ,CAACE,IAAT,CAAcC,QAAlB,CAA4B,CACxBC,MAAM,CAACC,QAAP,CAAgBC,IAAhB,CAAuBN,CAAQ,CAACE,IAAT,CAAcK,gBACxC,CAFD,IAEO,CACHd,QAAQ,CAACC,aAAT,CAAuB,kCAAvB,EAA2Dc,SAA3D,CAAuER,CAAQ,CAACE,IAAT,CAAcO,IAArF,CACAhB,QAAQ,CAACC,aAAT,CAAuB,kCAAvB,EAA2DgB,SAA3D,CAAqEC,MAArE,CAA4E,SAA5E,EACAlB,QAAQ,CAACC,aAAT,CAAuB,kCAAvB,EAA2DgB,SAA3D,CAAqEE,GAArE,CAAyE,SAAzE,EACAnB,QAAQ,CAACC,aAAT,CAAuB,4BAAvB,EAAqDgB,SAArD,CAA+DE,GAA/D,CAAmE,yBAAnE,CACH,CACJ,CATD,IASO,CACHnB,QAAQ,CAACC,aAAT,CAAuB,kCAAvB,EAA2Dc,SAA3D,CAAuER,CAAQ,CAACa,KAAhF,CACApB,QAAQ,CAACC,aAAT,CAAuB,kCAAvB,EAA2DgB,SAA3D,CAAqEE,GAArE,CAAyE,SAAzE,EACAnB,QAAQ,CAACC,aAAT,CAAuB,kCAAvB,EAA2DgB,SAA3D,CAAqEC,MAArE,CAA4E,SAA5E,EACAlB,QAAQ,CAACC,aAAT,CAAuB,4BAAvB,EAAqDgB,SAArD,CAA+DC,MAA/D,CAAsE,yBAAtE,CACH,CACJ,CAjBL,EAkBKG,IAlBL,CAkBUC,CAAY,CAACC,SAlBvB,CAmBH,C,QAOmB,QAAPC,CAAAA,IAAO,EAAM,CACtBxB,QAAQ,CAACC,aAAT,CAAuBnB,CAAS,CAACC,KAAjC,EAAwC0C,gBAAxC,CAAyD,MAAzD,CAAiE7B,CAAjE,EACAI,QAAQ,CAACC,aAAT,CAAuBnB,CAAS,CAACE,MAAjC,EAAyCyC,gBAAzC,CAA0D,OAA1D,CAAmE7B,CAAnE,CACH,C","sourcesContent":["// This file is part of Moodle - http://moodle.org/\n//\n// Moodle is free software: you can redistribute it and/or modify\n// it under the terms of the GNU General Public License as published by\n// the Free Software Foundation, either version 3 of the License, or\n// (at your option) any later version.\n//\n// Moodle is distributed in the hope that it will be useful,\n// but WITHOUT ANY WARRANTY; without even the implied warranty of\n// MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the\n// GNU General Public License for more details.\n//\n// You should have received a copy of the GNU General Public License\n// along with Moodle.  If not, see <http://www.gnu.org/licenses/>.\n\nimport * as Ajax from 'core/ajax';\nimport * as Notification from 'core/notification';\n\n/**\n * @type const\n */\nconst SELECTORS = {\n    input: '#id_coupon',\n    action: '#btncheckcoupon'\n};\n\n/**\n * Call server to validate given coupon code.\n *\n * @param {string} couponCode coupon code\n * @param {Number} courseId course ID\n * @param {Number} instanceId enrol instance ID\n * @returns {Promise<>}\n */\nconst checkCode = (couponCode, courseId, instanceId) => {\n    const request = {\n        methodname: 'enrol_gwpayments_check_coupon',\n        args: {\n            couponcode: couponCode,\n            courseid: courseId,\n            instanceid: instanceId\n        }\n    };\n\n    return Ajax.call([request])[0];\n};\n\n/**\n * Perform coupon code check.\n *\n * @param {Event} e\n * @returns {Promise}\n */\nconst performCheck = (e) => {\n    e.preventDefault();\n    let el = document.querySelector(SELECTORS.input);\n    if (typeof el === 'undefined' || el === null) {\n        return;\n    }\n    let code = el.value;\n    if (code.length === 0) {\n        return;\n    }\n    checkCode(code, el.dataset.courseid, el.dataset.instanceid)\n        .then((response) => {\n            if (response.result) {\n                if (response.data.freepass) {\n                    window.location.href = response.data.freepassredirect;\n                } else {\n                    document.querySelector('#enrol-gwpayments-coupondiscount').innerHTML = response.data.html;\n                    document.querySelector('#enrol-gwpayments-coupondiscount').classList.remove('warning');\n                    document.querySelector('#enrol-gwpayments-coupondiscount').classList.add('success');\n                    document.querySelector('#enrol-gwpayments-basecost').classList.add('enrol-gwpayments-strike');\n                }\n            } else {\n                document.querySelector('#enrol-gwpayments-coupondiscount').innerHTML = response.error;\n                document.querySelector('#enrol-gwpayments-coupondiscount').classList.add('warning');\n                document.querySelector('#enrol-gwpayments-coupondiscount').classList.remove('success');\n                document.querySelector('#enrol-gwpayments-basecost').classList.remove('enrol-gwpayments-strike');\n            }\n        })\n        .fail(Notification.exception);\n};\n\n/**\n * Exported initializer\n *\n * @returns {void}\n */\nexport const init = () => {\n    document.querySelector(SELECTORS.input).addEventListener('blur', performCheck);\n    document.querySelector(SELECTORS.action).addEventListener('click', performCheck);\n};\n"],"file":"module.min.js"}